{% extends "@DHAuditor/layout.html.twig" %}

{% import '@DHAuditor/Audit/helpers/helper.html.twig' as helper %}

{% block dh_auditor_content %}
    <div class="mb-8">
        <h1 class="text-xl font-semibold text-slate-900 dark:text-slate-100">
            {{ 'audit.home.title'|trans(domain='auditor') }}
        </h1>
        <p class="text-sm text-slate-500 dark:text-slate-400">
            {{ 'audit.home.subtitle'|trans(domain='auditor') }}
        </p>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        {% for entity, entityAuditData in audited %}
            <a href="{{ path('dh_auditor_show_entity_stream', {'entity': helper.namespaceToParam(entity)}) }}"
               class="rounded-xl border bg-white border-slate-200 p-4
                      hover:bg-slate-50 hover:border-slate-300 transition
                      dark:bg-slate-900 dark:border-slate-800 dark:hover:bg-slate-800">
                {# Header row with entity name, event count, and optional inline sparkline #}
                <div class="flex justify-between items-center gap-2">
                    <span class="font-medium truncate" title="{{ entity|e('html_attr') }}">{{ entity|split('\\')|last }}</span>
                    <div class="flex items-center gap-2 shrink-0 min-w-0 flex-1 justify-end">
                        <span class="text-xs text-slate-500 dark:text-slate-400 shrink-0">
                            {{ 'audit.audit_details.events_count'|trans({'%count%': entityAuditData.count|number_format}, 'auditor') }}
                        </span>
                        {% if activityGraphEnabled and activityGraphLayout == 'inline' and entityAuditData.activityGraph is defined %}
                            {{ helper.activity_sparkline(entityAuditData.activityGraph, activityGraphDays) }}
                        {% endif %}
                    </div>
                </div>
                <div class="text-xs text-slate-500 dark:text-slate-400 mt-1">
                    {{ 'audit.audit_details.last_activity'|trans(domain='auditor') }} ·
                    <span class="w-24 shrink-0">{{ helper.type_badge(entityAuditData.latest.type) }}</span> ·
                    {{ entityAuditData.latest.createdAt|time_ago }}
                </div>
                {# Bottom sparkline (Option B) #}
                {% if activityGraphEnabled and activityGraphLayout == 'bottom' and entityAuditData.activityGraph is defined %}
                    {{ helper.activity_sparkline_bottom(entityAuditData.activityGraph, activityGraphDays) }}
                {% endif %}
            </a>
        {% else %}
            <div class="col-span-full text-center text-slate-500 dark:text-slate-400 py-8">
                {{ 'audit.home.no_audits'|trans(domain='auditor') }}
            </div>
        {% endfor %}
    </div>
{% endblock dh_auditor_content %}
