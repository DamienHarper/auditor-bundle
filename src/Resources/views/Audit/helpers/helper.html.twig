{% macro dump(value, separator) %}
    {%- import _self as helper -%}
    {%- if value.label is defined -%}
        {{- value.label -}}
    {%- elseif value is iterable -%}
        {%- for k, v in value -%}
            {{- k }}: {{ helper.dump(v) }}{{ separator|default('<br/>')|raw -}}
        {%- endfor -%}
    {%- elseif value is same as(true) -%}
        true
    {%- elseif value is same as(false) -%}
        false
    {%- else -%}
        {{- value -}}
    {%- endif -%}
{% endmacro dump %}

{% macro namespaceToParam(entity) %}
{{- entity|replace({'\\': '-'}) -}}
{% endmacro namespaceToParam %}

{% macro type_badge(type) %}
    {%- if type == 'insert' -%}
        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400">INSERT</span>
    {%- elseif type == 'update' -%}
        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400">UPDATE</span>
    {%- elseif type == 'remove' -%}
        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-rose-100 text-rose-700 dark:bg-rose-900/30 dark:text-rose-400">REMOVE</span>
    {%- elseif type == 'associate' -%}
        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400">LINK</span>
    {%- elseif type == 'dissociate' -%}
        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-rose-50 text-rose-600 dark:bg-rose-900/20 dark:text-rose-300">UNLINK</span>
    {%- else -%}
        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-400">{{ type|upper }}</span>
    {%- endif -%}
{% endmacro type_badge %}

{# Option A: Sparkline compact (pour affichage inline dans le header, max 40% de largeur) #}
{% macro activity_sparkline(data, days) %}
    {% set hasActivity = data|filter(v => v > 0)|length > 0 %}
    <div class="flex items-end gap-px h-4 w-full max-w-[40%] shrink-0" title="{{ 'audit.activity_graph.period'|trans({'%days%': days}, 'auditor') }}">
        {% for value in data %}
            {% if hasActivity %}
                <div class="flex-1 bg-indigo-400 dark:bg-indigo-500 rounded-sm"
                     style="height: {{ value > 0 ? (value < 15 ? 15 : value) : 4 }}%"></div>
            {% else %}
                <div class="flex-1 bg-slate-300 dark:bg-slate-600 rounded-sm" style="height: 20%"></div>
            {% endif %}
        {% endfor %}
    </div>
{% endmacro activity_sparkline %}

{# Option B: Sparkline en bas, pleine largeur de la card #}
{% macro activity_sparkline_bottom(data, days) %}
    {% set hasActivity = data|filter(v => v > 0)|length > 0 %}
    <div class="mt-2 pt-2 border-t border-slate-100 dark:border-slate-800">
        <div class="flex items-end gap-px h-5">
            {% for value in data %}
                {% if hasActivity %}
                    <div class="flex-1 bg-indigo-400 dark:bg-indigo-500 rounded-sm"
                         style="height: {{ value > 0 ? (value < 15 ? 15 : value) : 4 }}%"></div>
                {% else %}
                    <div class="flex-1 bg-slate-300 dark:bg-slate-600 rounded-sm" style="height: 20%"></div>
                {% endif %}
            {% endfor %}
        </div>
        <div class="text-[9px] text-slate-400 dark:text-slate-500 mt-0.5">
            {% if hasActivity %}
                {{ 'audit.activity_graph.period'|trans({'%days%': days}, 'auditor') }}
            {% else %}
                {{ 'audit.activity_graph.no_activity'|trans(domain='auditor') }}
            {% endif %}
        </div>
    </div>
{% endmacro activity_sparkline_bottom %}

{# Legacy: garde l'ancien macro pour compatibilit√©, redirige vers sparkline_bottom #}
{% macro activity_graph(data, days, layout) %}
    {% import _self as helper %}
    {% if layout|default('bottom') == 'inline' %}
        {{ helper.activity_sparkline(data, days) }}
    {% else %}
        {{ helper.activity_sparkline_bottom(data, days) }}
    {% endif %}
{% endmacro activity_graph %}
